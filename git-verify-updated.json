{
    "local": [
        {
            "type": "validate-branch-names",
            "parameters": {
                "branches": ["$params.target"]
            }
        },
        {
            "type": "assert-existence",
            "parameters": {
                "branches": ["$params.target"],
                "shouldExist": true
            }
        },
        {
            "type": "assert-pushed",
            "parameters": {
                "target": "$params.target"
            }
        },
        {
            "type": "recurse",
            "condition": "$params.recurse",
            "parameters": {
                "inputParameters": [{
                    "target": "$params.target"
                }],
                "path": "git-verify-updated.recurse.json"
            }
        },
        {
            "id": "get-upstream",
            "type": "get-upstream",
            "condition": "$params.recurse ? $false : $true",
            "parameters": {
                "target": "$params.target"
            }
        },
        {
            "id": "merge-branches",
            "type": "merge-branches",
            "condition": "$params.recurse ? $false : $true",
            "parameters": {
                "source": "$($params.target)",
                "upstreamBranches": ["$actions['get-upstream'].outputs"],
                "mergeMessageTemplate": "Merge '{}' to $($params.target)"
            }
        },
        { 
            "type": "add-diagnostic",
            "condition": "$actions['merge-branches'].outputs['failed'] -AND -not $params.recurse",
            "parameters": {
                "message": "$($params.target) has incoming conflicts from $($actions['merge-branches'].outputs['failed'])."
            }
        },
        { 
            "type": "add-diagnostic",
            "condition": "$actions['merge-branches'].outputs['hasChanges'] ? -not $params.recurse : $false",
            "parameters": {
                "message": "$($params.target) did not have the latest from $($actions['merge-branches'].outputs['successful'])."
            }
        }
    ],
    "finalize": [],
    "output": [
        "$($params.target) is up-to-date with its upstreams"
    ]
}
